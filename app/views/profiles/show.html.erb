<% @title = "#{@profile.nickname}: プロフィール編集" %>
<% content_for :breadcrumb do %>
  <% if @service.present? %><li><%= link_to @service.title, @service.root %></li><% end %>
<% end %>
<% content_for :head do -%>
  <%= javascript_include_tag "edit_profile" %>
<% end %>

<div class="container" style="margin-top: 1em;">
  <% if @profile.errors.any? %>
    <div class="panel panel-warning">
      <div class="panel-heading">
        <h3 class="panel-title">入力にエラーがあります</h3>
      </div>
      <div class="panel-body">
        <ul>
        <% @profile.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <%= form_for(@profile) do |f| %>
    <h2>プロフィール編集</h2>

    <div class="form-group">
      <label for="profile_nickname">ニックネーム</label>
      <%= f.text_field :nickname, :class => 'form-control' %>
    </div>

    <div class="form-group">
      <label for="profile_profile_text">自己紹介文</label>
      <%= f.text_area :profile_text, :class => 'form-control' %>
    </div>
    <%= hidden_field_tag 'id', params[:service_id] %>
  <% end %>

  <div>
    <h2>ログインに使用できるOpenID</h2>
    <ul>
      <% @profile.openid_urls.each do |openid_url| %>
        <li style="margin-bottom: 5px;">
          <%= openid_url.str %>
          <button class="btn btn-default" data-toggle="modal" data-target="#openid-<%= openid_url.id %>">
            <i class="glyphicon glyphicon-pencil"></i>
          </button>
        </li>
      <% end %>
    </ul>

    <%= link_to '新しいOpenIDを追加する', profile_authenticate_path(:mode => 'id_append'), :class => 'btn btn-default' %>
    <%= link_to "#{@service.title}へ戻る", back_from_profile(@service, @login_profile), :class => 'btn btn-default' if @service.present? %>
  </div>
</div>

<% @profile.openid_urls.each do |openid_url| %>
  <div class="modal fade" id="openid-<%= openid_url.id %>">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
          <h4 class="modal-title">IDについて</h4>
        </div>
        <div class="modal-body">
          <p>
            <%= openid_url.str %>
          </p>

          <% if openid_url.primary_openid %>
            <p>
              これは主OpenIDです。プロフィールから削除できません。
            </p>
          <% end %>
        </div>
        <div class="modal-footer">
          <% unless openid_url.primary_openid %>
            <%= form_for openid_url, :html => {:id => "delete_openid_url_#{openid_url.id}", :style => 'display: inline'} do %>
              <%= hidden_field_tag '_method', 'delete' %>
              <button type="submit" class="btn btn-danger">削除する</button>
            <% end %>
          <% end %>
          <button type="button" class="btn btn-primary" data-dismiss="modal">閉じる</button>
        </div>
      </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
  </div><!-- /.modal -->
<% end %>
